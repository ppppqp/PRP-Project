{"ast":null,"code":"import * as d3 from \"d3\";\nimport \"./style.css\";\nimport \"./earth.css\";\nimport \"./d3tip.css\";\n\nconst draw = props => {\n  /*\n    d3.select('.vis-barchart > *').remove();\n    const data = props.data;\n    const margin = {top: 20, right: 20, bottom: 30, left: 40};\n    const width = props.width - margin.left - margin.right;\n    const height = props.height - margin.top - margin.bottom;\n    let svg = d3.select('.vis-barchart').append('svg')\n            .attr('width',width + margin.left + margin.right)\n            .attr('height',height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n     // format the data\n    data.forEach(function(d) {\n        d.age = +d.age;\n    });\n     // Scale the range of the data in the domains\n    let x = d3.scaleBand()\n          .range([0, width])\n          .padding(0.1);\n    let y = d3.scaleLinear()\n          .range([height, 0]);\n    x.domain(data.map(function(d) { return d.name; }));\n    y.domain([0, d3.max(data, function(d) { return d.age; })]);\n     // append the rectangles for the bar chart\n    svg.selectAll(\".bar\")\n        .data(data)\n        .enter().append(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"x\", function(d) { return x(d.name); })\n        .attr(\"width\", x.bandwidth())\n        .attr(\"y\", function(d) { return y(d.age); })\n        .attr(\"height\", function(d) { return height - y(d.age); });\n     // add the x Axis\n    svg.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        .call(d3.axisBottom(x));\n     // add the y Axis\n    svg.append(\"g\")\n        .call(d3.axisLeft(y));\n      */\n  //d3.select(\"#svgID\").remove(); //删除整个SVG\n  //d3.select(\"#svgID\").selectAll(\"*\").remove(); //清空SVG中的内容\n  const {\n    data,\n    h,\n    w,\n    attr1,\n    attr2\n  } = props;\n  let svg = d3.select(\"svg\").attr(\"height\", h).attr(\"width\", w).attr(\"class\", \"svgs\").attr(\"id\", \"mainsvg\");\n  const width = +svg.attr(\"width\");\n  const height = +svg.attr(\"height\");\n  const margin = {\n    top: 60,\n    right: 60,\n    bottom: 10,\n    left: 60\n  };\n  const innerWidth = width - margin.left - margin.right;\n  const innerHeight = height - margin.top - margin.bottom;\n  const g = svg.append(\"g\").attr(\"id\", \"maingroup\").attr(\"transform\", `translate(${margin.left}, ${margin.top})`); // convert dataPath to svgPath;\n  // go to https://github.com/d3/d3-geo for more different projections;\n  //const projection = d3.geoMercator();\n  //const projection = d3.geoOrthographic();\n  //const projection = d3.geoStereographic();\n  //const projection = d3.geoEquirectangular();\n\n  const projection = d3.geoNaturalEarth1(); //const projection = d3.geoTransverseMercator();\n\n  const pathGenerator = d3.geoPath().projection(projection); // setting up the tip tool;\n\n  const tip = d3.tip().attr(\"class\", \"d3-tip\").html(function (d) {\n    return d.properties.name;\n  });\n  svg.call(tip);\n  let worldmeta;\n  let lastid = undefined; // convert topo-json to geo-json;\n\n  worldmeta = topojson.feature(data, data.objects.countries); // this code is really important if you want to fit your geoPaths (map) in your SVG element;\n\n  projection.fitSize([innerWidth, innerHeight], worldmeta); // perform data-join;\n\n  const paths = g.selectAll(\"path\").data(worldmeta.features, d => d.properties.name).enter().append(\"path\").attr(\"d\", pathGenerator).attr(\"stroke\", \"black\").attr(\"stroke-width\", 1).on(\"mouseover\", function (d) {\n    d3.select(this).attr(\"opacity\", 0.5).attr(\"stroke\", \"white\").attr(\"stroke-width\", 6);\n  }).on(\"mouseout\", function (d) {\n    //不能用箭头函数\n    d3.select(this).attr(\"opacity\", 1).attr(\"stroke\", \"black\").attr(\"stroke-width\", 1);\n  });\n  /*.on(\"contextmenu\", function (d) {\n      d3.event.preventDefault();\n      if (lastid !== d.properties.name) {\n        tip.show(d);\n        lastid = d.properties.name;\n      } else {\n        tip.hide(d);\n      }\n    });\n    */\n};\n\nexport default draw;","map":{"version":3,"sources":["/Users/panqp/Documents/React/hw4/src/charts/BarChart/vis.js"],"names":["d3","draw","props","data","h","w","attr1","attr2","svg","select","attr","width","height","margin","top","right","bottom","left","innerWidth","innerHeight","g","append","projection","geoNaturalEarth1","pathGenerator","geoPath","tip","html","d","properties","name","call","worldmeta","lastid","undefined","topojson","feature","objects","countries","fitSize","paths","selectAll","features","enter","on"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\nimport \"./style.css\";\nimport \"./earth.css\";\nimport \"./d3tip.css\";\nconst draw = (props) => {\n  /*\n    d3.select('.vis-barchart > *').remove();\n    const data = props.data;\n    const margin = {top: 20, right: 20, bottom: 30, left: 40};\n    const width = props.width - margin.left - margin.right;\n    const height = props.height - margin.top - margin.bottom;\n    let svg = d3.select('.vis-barchart').append('svg')\n            .attr('width',width + margin.left + margin.right)\n            .attr('height',height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    // format the data\n    data.forEach(function(d) {\n        d.age = +d.age;\n    });\n\n    // Scale the range of the data in the domains\n    let x = d3.scaleBand()\n          .range([0, width])\n          .padding(0.1);\n    let y = d3.scaleLinear()\n          .range([height, 0]);\n    x.domain(data.map(function(d) { return d.name; }));\n    y.domain([0, d3.max(data, function(d) { return d.age; })]);\n\n    // append the rectangles for the bar chart\n    svg.selectAll(\".bar\")\n        .data(data)\n        .enter().append(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"x\", function(d) { return x(d.name); })\n        .attr(\"width\", x.bandwidth())\n        .attr(\"y\", function(d) { return y(d.age); })\n        .attr(\"height\", function(d) { return height - y(d.age); });\n\n    // add the x Axis\n    svg.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        .call(d3.axisBottom(x));\n\n    // add the y Axis\n    svg.append(\"g\")\n        .call(d3.axisLeft(y));\n\n\n    */\n  //d3.select(\"#svgID\").remove(); //删除整个SVG\n  //d3.select(\"#svgID\").selectAll(\"*\").remove(); //清空SVG中的内容\n  const { data, h, w, attr1, attr2 } = props;\n\n  let svg = d3\n    .select(\"svg\")\n    .attr(\"height\", h)\n    .attr(\"width\", w)\n    .attr(\"class\", \"svgs\")\n    .attr(\"id\", \"mainsvg\");\n  const width = +svg.attr(\"width\");\n  const height = +svg.attr(\"height\");\n  const margin = { top: 60, right: 60, bottom: 10, left: 60 };\n  const innerWidth = width - margin.left - margin.right;\n  const innerHeight = height - margin.top - margin.bottom;\n  const g = svg\n    .append(\"g\")\n    .attr(\"id\", \"maingroup\")\n    .attr(\"transform\", `translate(${margin.left}, ${margin.top})`);\n\n  // convert dataPath to svgPath;\n  // go to https://github.com/d3/d3-geo for more different projections;\n  //const projection = d3.geoMercator();\n  //const projection = d3.geoOrthographic();\n  //const projection = d3.geoStereographic();\n  //const projection = d3.geoEquirectangular();\n  const projection = d3.geoNaturalEarth1();\n  //const projection = d3.geoTransverseMercator();\n  const pathGenerator = d3.geoPath().projection(projection);\n\n  // setting up the tip tool;\n  const tip = d3\n    .tip()\n    .attr(\"class\", \"d3-tip\")\n    .html(function (d) {\n      return d.properties.name;\n    });\n  svg.call(tip);\n\n  let worldmeta;\n  let lastid = undefined;\n\n  // convert topo-json to geo-json;\n  worldmeta = topojson.feature(data, data.objects.countries);\n\n  // this code is really important if you want to fit your geoPaths (map) in your SVG element;\n  projection.fitSize([innerWidth, innerHeight], worldmeta);\n\n  // perform data-join;\n  const paths = g\n    .selectAll(\"path\")\n    .data(worldmeta.features, (d) => d.properties.name)\n    .enter()\n    .append(\"path\")\n    .attr(\"d\", pathGenerator)\n    .attr(\"stroke\", \"black\")\n    .attr(\"stroke-width\", 1)\n    .on(\"mouseover\", function (d) {\n      d3.select(this)\n        .attr(\"opacity\", 0.5)\n        .attr(\"stroke\", \"white\")\n        .attr(\"stroke-width\", 6);\n    })\n    .on(\"mouseout\", function (d) {\n      //不能用箭头函数\n      d3.select(this)\n        .attr(\"opacity\", 1)\n        .attr(\"stroke\", \"black\")\n        .attr(\"stroke-width\", 1);\n    });\n  /*.on(\"contextmenu\", function (d) {\n      d3.event.preventDefault();\n      if (lastid !== d.properties.name) {\n        tip.show(d);\n        lastid = d.properties.name;\n      } else {\n        tip.hide(d);\n      }\n    });\n    */\n};\n\nexport default draw;\n"]},"metadata":{},"sourceType":"module"}