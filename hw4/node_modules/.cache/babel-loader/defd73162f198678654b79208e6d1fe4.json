{"ast":null,"code":"import * as d3 from \"d3\";\nimport { select, geoNaturalEarth1, scaleSqrt, max, format, selectAll, tsv, json } from \"d3\";\nimport { color } from \"../../d3/Color\";\nimport d3Tip from \"d3-tip\";\nimport { feature } from \"topojson\";\nimport \"./style.css\";\nimport \"./earth.css\";\nimport \"./d3tip.css\";\n\nconst draw = props => {\n  d3.select(\"#mainsvg\").remove(); //删除整个SVG\n\n  d3.select(\"#mainsvg\").selectAll(\"*\").remove(); //清空SVG中的内容\n\n  const {\n    data,\n    h,\n    w,\n    attr,\n    year\n  } = props;\n  let svg = d3.select(\".vis-barchart\").append(\"svg\").attr(\"height\", h).attr(\"width\", w).attr(\"class\", \"svgs\").attr(\"id\", \"mainsvg\");\n  const width = +svg.attr(\"width\");\n  const height = +svg.attr(\"height\");\n  const margin = {\n    top: 20,\n    right: 20,\n    bottom: 20,\n    left: 20\n  }; //const innerWidth = width - margin.left - margin.right;\n  //const innerHeight = height - margin.top - margin.bottom;\n\n  const innerWidth = width;\n  const innerHeight = height;\n  const g = svg.append(\"g\").attr(\"id\", \"maingroup\").attr(\"transform\", `translate(${0}, ${0})`);\n  const projection = d3.geoNaturalEarth1();\n  const pathGenerator = d3.geoPath().projection(projection); // setting up the tip tool;\n\n  /*\n  const tip = d3\n    .tip()\n    .attr(\"class\", \"d3-tip\")\n    .html(function (d) {\n      return d.properties.name;\n    });\n  svg.call(tip);\n    */\n\n  let lastid = undefined;\n  Promise.all([tsv(\"https://unpkg.com/world-atlas@1.1.4/world/50m.tsv\"), json(\"https://unpkg.com/world-atlas@1.1.4/world/50m.json\")]).then(([tsvData, topoJSONdata]) => {\n    // parses tsvData to extract country names for base map titles\n    const countryName = {};\n    tsvData.forEach(d => {\n      countryName[d.iso_n3] = d.name;\n    }); // draws a path for each country with countryName as title (shown on hover)\n\n    var worldmeta = feature(topoJSONdata, topoJSONdata.objects.countries);\n    projection.fitSize([innerWidth, innerHeight], worldmeta);\n    g.selectAll(\"path\").data(worldmeta.features).enter().append(\"path\").attr(\"class\", \"country\").attr(\"d\", pathGenerator).attr(\"stroke\", \"grey\").attr(\"stroke-width\", 1).on(\"mouseover\", function (d) {\n      d3.select(this).attr(\"opacity\", 0.5).attr(\"stroke\", \"white\").attr(\"stroke-width\", 3);\n    }).on(\"mouseout\", function (d) {\n      //不能用箭头函数\n      d3.select(this).attr(\"opacity\", 1).attr(\"stroke\", \"black\").attr(\"stroke-width\", 1);\n    }); //.append(\"title\")\n    //.text((d) => countryName[d.id]);\n  }); // draws a path for each country with countryName as title (shown on hover)\n\n  /*\n    const countries = feature(topoJSONdata, topoJSONdata.objects.countries);\n    g.selectAll(\"path\")\n      .data(countries.features)\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", \"country\")\n      .attr(\"d\", pathGenerator)\n      .append(\"title\")\n      .text((d) => countryName[d.id]);\n       */\n\n  const radiusValue = d => +d.datum + 20;\n\n  const sizeScale = scaleSqrt().domain([0, max(data, d => +d.datum, radiusValue)]).range([0, 5]);\n  g.selectAll(\"circle\").data(data).enter().append(\"circle\").attr(\"class\", \"country-circle\") // setting x and y coordiantes by translating country coordinate data to pixels\n  //.attr(\"transform\", function (d) {\n  //return \"translate(\" + projection([0, 0]) + \")\";\n  .attr(\"transform\", function (d) {\n    return \"translate(\" + projection([d.long - 10, d.lat - 30]) + \")\";\n  }) //})\n  .attr(\"r\", d => sizeScale(radiusValue(d))).attr(\"fill\", \"red\").attr(\"opacity\", 0.8).append(\"title\"); //.text(\n  // (d) => d.country + \" \" + caseTitle + \": \" + format(\",\")(d[`${caseType}`])\n  //);\n\n  /*\n  svg.call(\n    zoom().on(\"zoom\", () => {\n      g.attr(\"transform\", event.transform);\n    })\n  );\n  */\n\n  /*\n  .on(\"contextmenu\", function (d) {\n    //d3.event.preventDefault();\n    if (lastid !== d.properties.name) {\n      tip.show(d);\n      lastid = d.properties.name;\n    } else {\n      tip.hide(d);\n    }\n  });\n  */\n};\n\nexport default draw;","map":{"version":3,"sources":["/Users/panqp/Documents/React/hw4/src/charts/BarChart/vis.js"],"names":["d3","select","geoNaturalEarth1","scaleSqrt","max","format","selectAll","tsv","json","color","d3Tip","feature","draw","props","remove","data","h","w","attr","year","svg","append","width","height","margin","top","right","bottom","left","innerWidth","innerHeight","g","projection","pathGenerator","geoPath","lastid","undefined","Promise","all","then","tsvData","topoJSONdata","countryName","forEach","d","iso_n3","name","worldmeta","objects","countries","fitSize","features","enter","on","radiusValue","datum","sizeScale","domain","range","long","lat"],"mappings":"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","sourcesContent":["import * as d3 from \"d3\";\n\nimport {\n  select,\n  geoNaturalEarth1,\n  scaleSqrt,\n  max,\n  format,\n  selectAll,\n  tsv,\n  json,\n} from \"d3\";\nimport { color } from \"../../d3/Color\";\nimport d3Tip from \"d3-tip\";\nimport { feature } from \"topojson\";\nimport \"./style.css\";\nimport \"./earth.css\";\nimport \"./d3tip.css\";\nconst draw = (props) => {\n  d3.select(\"#mainsvg\").remove(); //删除整个SVG\n  d3.select(\"#mainsvg\").selectAll(\"*\").remove(); //清空SVG中的内容\n  const { data, h, w, attr, year } = props;\n  let svg = d3\n    .select(\".vis-barchart\")\n    .append(\"svg\")\n    .attr(\"height\", h)\n    .attr(\"width\", w)\n    .attr(\"class\", \"svgs\")\n    .attr(\"id\", \"mainsvg\");\n  const width = +svg.attr(\"width\");\n  const height = +svg.attr(\"height\");\n  const margin = { top: 20, right: 20, bottom: 20, left: 20 };\n  //const innerWidth = width - margin.left - margin.right;\n  //const innerHeight = height - margin.top - margin.bottom;\n  const innerWidth = width;\n  const innerHeight = height;\n  const g = svg\n    .append(\"g\")\n    .attr(\"id\", \"maingroup\")\n    .attr(\"transform\", `translate(${0}, ${0})`);\n  const projection = d3.geoNaturalEarth1();\n  const pathGenerator = d3.geoPath().projection(projection);\n\n  // setting up the tip tool;\n  /*\n  const tip = d3\n    .tip()\n    .attr(\"class\", \"d3-tip\")\n    .html(function (d) {\n      return d.properties.name;\n    });\n  svg.call(tip);\n    */\n\n  let lastid = undefined;\n  Promise.all([\n    tsv(\"https://unpkg.com/world-atlas@1.1.4/world/50m.tsv\"),\n    json(\"https://unpkg.com/world-atlas@1.1.4/world/50m.json\"),\n  ]).then(([tsvData, topoJSONdata]) => {\n    // parses tsvData to extract country names for base map titles\n    const countryName = {};\n    tsvData.forEach((d) => {\n      countryName[d.iso_n3] = d.name;\n    });\n\n    // draws a path for each country with countryName as title (shown on hover)\n    var worldmeta = feature(topoJSONdata, topoJSONdata.objects.countries);\n    projection.fitSize([innerWidth, innerHeight], worldmeta);\n\n    g.selectAll(\"path\")\n      .data(worldmeta.features)\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", \"country\")\n      .attr(\"d\", pathGenerator)\n\n      .attr(\"stroke\", \"grey\")\n      .attr(\"stroke-width\", 1)\n      .on(\"mouseover\", function (d) {\n        d3.select(this)\n          .attr(\"opacity\", 0.5)\n          .attr(\"stroke\", \"white\")\n          .attr(\"stroke-width\", 3);\n      })\n      .on(\"mouseout\", function (d) {\n        //不能用箭头函数\n        d3.select(this)\n          .attr(\"opacity\", 1)\n          .attr(\"stroke\", \"black\")\n          .attr(\"stroke-width\", 1);\n      });\n    //.append(\"title\")\n    //.text((d) => countryName[d.id]);\n  });\n\n  // draws a path for each country with countryName as title (shown on hover)\n  /*\n    const countries = feature(topoJSONdata, topoJSONdata.objects.countries);\n    g.selectAll(\"path\")\n      .data(countries.features)\n      .enter()\n      .append(\"path\")\n      .attr(\"class\", \"country\")\n      .attr(\"d\", pathGenerator)\n      .append(\"title\")\n      .text((d) => countryName[d.id]);\n       */\n\n  const radiusValue = (d) => +d.datum + 20;\n\n  const sizeScale = scaleSqrt()\n    .domain([0, max(data, (d) => +d.datum, radiusValue)])\n    .range([0, 5]);\n\n  g.selectAll(\"circle\")\n    .data(data)\n    .enter()\n    .append(\"circle\")\n    .attr(\"class\", \"country-circle\")\n    // setting x and y coordiantes by translating country coordinate data to pixels\n    //.attr(\"transform\", function (d) {\n    //return \"translate(\" + projection([0, 0]) + \")\";\n    .attr(\"transform\", function (d) {\n      return \"translate(\" + projection([d.long - 10, d.lat - 30]) + \")\";\n    })\n    //})\n    .attr(\"r\", (d) => sizeScale(radiusValue(d)))\n    .attr(\"fill\", \"red\")\n    .attr(\"opacity\", 0.8)\n    .append(\"title\");\n\n  //.text(\n  // (d) => d.country + \" \" + caseTitle + \": \" + format(\",\")(d[`${caseType}`])\n  //);\n  /*\n  svg.call(\n    zoom().on(\"zoom\", () => {\n      g.attr(\"transform\", event.transform);\n    })\n  );\n*/\n  /*\n  .on(\"contextmenu\", function (d) {\n    //d3.event.preventDefault();\n    if (lastid !== d.properties.name) {\n      tip.show(d);\n      lastid = d.properties.name;\n    } else {\n      tip.hide(d);\n    }\n  });\n  */\n};\n\nexport default draw;\n"]},"metadata":{},"sourceType":"module"}